name: Sync to Grafana

on:
  push:
    branches: [ main ]
    paths: [ '**.json' ]

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Sync dashboards
      env:
        URL: ${{ secrets.GRAFANA_URL }}
        TOKEN: ${{ secrets.GRAFANA_API_TOKEN }}
      run: |
        # Install curl if needed
        command -v curl >/dev/null || sudo apt-get update && sudo apt-get install -y curl
        
        for file in *.json; do
          echo "Syncing $file"
          curl -X POST \
            -H "Authorization: Bearer $TOKEN" \
            -H "Content-Type: application/json" \
            --data-binary @$file \
            "$URL/api/dashboards/db" && echo "✅ Done" || echo "❌ Failed"
        done
